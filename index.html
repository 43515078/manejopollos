<!DOCTYPE html>
<html>
<head>
    <title>üêî Pollos COB500</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Estilos Generales */
        body {
            font-family: Arial, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        h1 {
            color: #4361ee;
            text-align: center;
            margin-bottom: 25px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* Estilos para M√≥viles */
        @media (max-width: 600px) {
            body {
                padding-bottom: 70px;
            }
            #modo-movil {
                display: flex;
                justify-content: space-around;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: #4361ee;
                padding: 10px 0;
                z-index: 1000;
            }
            #modo-movil button {
                background: none;
                border: none;
                color: white;
                font-size: 20px;
            }
            .seccion {
                display: none;
            }
            .seccion-activa {
                display: block;
            }
        }
        
        /* Estilos Mejorados */
        .indicadores {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .indicador {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            background: #f0f7ff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f0f7ff;
        }
        input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin: 8px 0;
            font-size: 16px;
        }
        button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: #4361ee;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            font-size: 16px;
        }
        button:hover {
            opacity: 0.9;
        }
        .notificacion {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 8px;
            color: white;
            animation: fadeIn 0.5s;
            z-index: 1000;
        }
        .exito {
            background: #4CAF50;
        }
        .alerta {
            background: #FF9800;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Modo Nocturno */
        .modo-nocturno {
            background-color: #121212;
            color: #e0e0e0;
        }
        .modo-nocturno .card {
            background-color: #1e1e1e;
        }
        .modo-nocturno input,
        .modo-nocturno table {
            background-color: #2d2d2d;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêî MANEJO DE POLLOS COB500</h1>
        
        <!-- Panel de Navegaci√≥n M√≥vil -->
        <div id="modo-movil">
            <button onclick="mostrarSeccion('resumen')">üìä</button>
            <button onclick="mostrarSeccion('registro')">‚úçÔ∏è</button>
            <button onclick="mostrarSeccion('proyeccion')">üìà</button>
            <button onclick="toggleModoNocturno()">üåô</button>
        </div>
        
        <!-- Secci√≥n de Resumen -->
        <div id="resumen" class="seccion seccion-activa">
            <div class="card">
                <div class="indicadores">
                    <div class="indicador">
                        <span>Pollos vivos</span>
                        <strong id="vivos">0</strong>
                    </div>
                    <div class="indicador">
                        <span>Pollos muertos</span>
                        <strong id="muertos">0</strong>
                    </div>
                </div>
                <div class="indicadores">
                    <div class="indicador">
                        <span>D√≠as transcurridos</span>
                        <strong id="dias-transcurridos">0</strong>
                    </div>
                    <div class="indicador">
                        <span>Consumo hoy</span>
                        <strong id="consumo">0 kg</strong>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>üìÖ Historial de Mortalidad</h3>
                <table id="historial-mortalidad">
                    <tr><th>Fecha</th><th>Cantidad</th></tr>
                </table>
            </div>
        </div>
        
        <!-- Secci√≥n de Registro -->
        <div id="registro" class="seccion">
            <div class="card">
                <h3>Iniciar nueva crianza</h3>
                <input type="number" id="pollos-iniciales" placeholder="Cantidad de pollos">
                <button onclick="iniciarCrianza()">üü¢ Iniciar</button>
            </div>

            <div class="card">
                <h3>Registrar mortalidad</h3>
                <input type="number" id="muertos-hoy" placeholder="Pollos muertos hoy">
                <button onclick="registrarMuertos()">‚úçÔ∏è Registrar</button>
            </div>
            
            <div class="card">
                <h3>üíµ Calculadora de Costos</h3>
                <input type="number" id="precio-alimento" placeholder="Precio por kg ($)">
                <button onclick="calcularCostos()">Calcular</button>
                <div id="resultado-costos" style="margin-top: 10px;"></div>
            </div>
        </div>
        
        <!-- Secci√≥n de Proyecci√≥n -->
        <div id="proyeccion" class="seccion">
            <div class="card">
                <h3>Proyecci√≥n de consumo</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Fase</th>
                            <th>Consumo semanal</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td rowspan="3">Inicio</td>
                            <td id="semana1">0 kg</td>
                            <td rowspan="3" id="total-inicio">0 kg</td>
                        </tr>
                        <tr>
                            <td id="semana2">0 kg</td>
                        </tr>
                        <tr>
                            <td id="semana3">0 kg</td>
                        </tr>
                        <tr>
                            <td rowspan="2">Crecimiento</td>
                            <td id="semana4">0 kg</td>
                            <td rowspan="2" id="total-crecimiento">0 kg</td>
                        </tr>
                        <tr>
                            <td id="semana5">0 kg</td>
                        </tr>
                        <tr>
                            <td>Engorde</td>
                            <td id="semana6">0 kg</td>
                            <td id="total-engorde">0 kg</td>
                        </tr>
                        <tr style="font-weight: bold; background: #f0f7ff;">
                            <td colspan="2">Total 42 d√≠as</td>
                            <td id="consumo-total">0 kg</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <h3>üå§Ô∏è Clima Recomendado</h3>
                <div id="clima-recomendado">
                    <p>Temperatura ideal: 24-28¬∞C</p>
                    <p>Humedad: 50-70%</p>
                </div>
            </div>
            
            <button onclick="exportarDatos()" style="background: #6d4c41;">üì§ Exportar Datos</button>
        </div>
    </div>

    <script>
        // Datos persistentes
        let datos = JSON.parse(localStorage.getItem('pollos')) || {
            pollosIniciales: 0,
            pollosMuertos: 0,
            fechaInicio: null,
            historialMuertos: []
        };

        // Factores de consumo (gramos/pollo/d√≠a)
        const consumoDiario = {
            0: 20.30,  // Semana 1 (0-6 d√≠as)
            1: 46.90,  // Semana 2 (7-13 d√≠as)
            2: 90.00,  // Semana 3 (14-20 d√≠as)
            3: 142.10, // Semana 4 (21-27 d√≠as)
            4: 183.70, // Semana 5 (28-34 d√≠as)
            5: 206.60  // Semana 6 (35-41 d√≠as)
        };

        // Funciones principales
        function actualizar() {
            const pollosVivos = datos.pollosIniciales - datos.pollosMuertos;
            const dias = calcularDias();
            
            // Actualizar valores principales
            document.getElementById('vivos').textContent = pollosVivos;
            document.getElementById('muertos').textContent = datos.pollosMuertos;
            document.getElementById('dias-transcurridos').textContent = dias;
            
            // Calcular consumo diario
            const semanaActual = Math.min(Math.floor(dias / 7), 5);
            const consumoHoy = (pollosVivos * consumoDiario[semanaActual]) / 1000;
            document.getElementById('consumo').textContent = consumoHoy.toFixed(2) + ' kg';
            
            // Actualizar proyecci√≥n
            actualizarProyeccion();
            
            // Actualizar historial
            actualizarHistorial();
            
            // Verificar alertas
            verificarAlertas();
        }

        function calcularDias() {
            if (!datos.fechaInicio) return 0;
            const unDia = 24 * 60 * 60 * 1000;
            return Math.floor((new Date() - new Date(datos.fechaInicio)) / unDia);
        }

        function actualizarProyeccion() {
            const semana1 = (datos.pollosIniciales * consumoDiario[0] * 7) / 1000;
            const semana2 = (datos.pollosIniciales * consumoDiario[1] * 7) / 1000;
            const semana3 = (datos.pollosIniciales * consumoDiario[2] * 7) / 1000;
            const semana4 = (datos.pollosIniciales * consumoDiario[3] * 7) / 1000;
            const semana5 = (datos.pollosIniciales * consumoDiario[4] * 7) / 1000;
            const semana6 = (datos.pollosIniciales * consumoDiario[5] * 7) / 1000;
            
            document.getElementById('semana1').textContent = semana1.toFixed(2) + ' kg';
            document.getElementById('semana2').textContent = semana2.toFixed(2) + ' kg';
            document.getElementById('semana3').textContent = semana3.toFixed(2) + ' kg';
            document.getElementById('semana4').textContent = semana4.toFixed(2) + ' kg';
            document.getElementById('semana5').textContent = semana5.toFixed(2) + ' kg';
            document.getElementById('semana6').textContent = semana6.toFixed(2) + ' kg';
            
            const totalInicio = semana1 + semana2 + semana3;
            const totalCrecimiento = semana4 + semana5;
            const totalEngorde = semana6;
            const totalGeneral = totalInicio + totalCrecimiento + totalEngorde;
            
            document.getElementById('total-inicio').textContent = totalInicio.toFixed(2) + ' kg';
            document.getElementById('total-crecimiento').textContent = totalCrecimiento.toFixed(2) + ' kg';
            document.getElementById('total-engorde').textContent = totalEngorde.toFixed(2) + ' kg';
            document.getElementById('consumo-total').textContent = totalGeneral.toFixed(2) + ' kg';
        }

        function actualizarHistorial() {
            const tabla = document.getElementById('historial-mortalidad');
            // Mantener el encabezado
            tabla.innerHTML = '<tr><th>Fecha</th><th>Cantidad</th></tr>';
            
            // Agregar registros
            datos.historialMuertos.forEach(registro => {
                const nuevaFila = `<tr><td>${registro.fecha}</td><td>${registro.cantidad}</td></tr>`;
                tabla.innerHTML += nuevaFila;
            });
        }

        // Funciones de interacci√≥n
        function iniciarCrianza() {
            const cantidad = parseInt(document.getElementById('pollos-iniciales').value);
            if (cantidad > 0) {
                datos.pollosIniciales = cantidad;
                datos.pollosMuertos = 0;
                datos.fechaInicio = new Date().toISOString();
                datos.historialMuertos = [];
                guardarDatos();
                actualizar();
                mostrarNotificacion('¬°Crianza iniciada con ' + cantidad + ' pollos!', 'exito');
                document.getElementById('pollos-iniciales').value = '';
            }
        }

        function registrarMuertos() {
            const muertos = parseInt(document.getElementById('muertos-hoy').value) || 0;
            if (muertos > 0) {
                datos.pollosMuertos += muertos;
                datos.historialMuertos.push({
                    fecha: new Date().toLocaleDateString(),
                    cantidad: muertos
                });
                guardarDatos();
                actualizar();
                mostrarNotificacion('Registrados ' + muertos + ' pollos muertos', 'exito');
                document.getElementById('muertos-hoy').value = '';
            }
        }

        function guardarDatos() {
            localStorage.setItem('pollos', JSON.stringify(datos));
        }

        // Funciones de las mejoras
        function mostrarNotificacion(mensaje, tipo = "exito") {
            const notificacion = document.createElement("div");
            notificacion.className = `notificacion ${tipo}`;
            notificacion.innerHTML = mensaje;
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.remove();
            }, 3000);
        }

        function verificarAlertas() {
            if (datos.pollosIniciales === 0) return;
            
            const tasaMortalidad = (datos.pollosMuertos / datos.pollosIniciales) * 100;
            if (tasaMortalidad > 5) {
                mostrarNotificacion(`‚ö†Ô∏è Alta mortalidad: ${tasaMortalidad.toFixed(1)}%`, "alerta");
            }
        }

        function calcularCostos() {
            const precioKg = parseFloat(document.getElementById('precio-alimento').value);
            if (isNaN(precioKg)) return;
            
            const consumoTotal = parseFloat(document.getElementById('consumo-total').textContent);
            const costoTotal = (consumoTotal * precioKg).toFixed(2);
            document.getElementById('resultado-costos').innerHTML = `
                <p><strong>Costo total estimado:</strong> $${costoTotal}</p>
            `;
        }

        function exportarDatos() {
            const blob = new Blob([JSON.stringify(datos)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pollos-${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        function toggleModoNocturno() {
            document.body.classList.toggle('modo-nocturno');
            localStorage.setItem('modoNocturno', document.body.classList.contains('modo-nocturno'));
        }

        function mostrarSeccion(id) {
            document.querySelectorAll('.seccion').forEach(seccion => {
                seccion.classList.remove('seccion-activa');
            });
            document.getElementById(id).classList.add('seccion-activa');
        }

        // Inicializaci√≥n
        if (localStorage.getItem('modoNocturno') === 'true') {
            document.body.classList.add('modo-nocturno');
        }
        
        if (new Date().getHours() > 18 || new Date().getHours() < 6) {
            document.body.classList.add('modo-nocturno');
        }

        actualizar();
    </script>
</body>
</html>
