<!DOCTYPE html>
<html>
<head>
    <title>游냆 Pollos COB500</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- [Estilos permanecen igual] -->
    <style>
        /* [Todos los estilos anteriores se mantienen igual] */
    </style>
</head>
<body>
    <div class="container">
        <h1>游냆 MANEJO DE POLLOS COB500</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="mostrarTab('resumen')">Resumen</div>
            <div class="tab" onclick="mostrarTab('mortalidad')">Mortalidad</div>
            <div class="tab" onclick="mostrarTab('consumo')">Consumo</div>
        </div>

        <!-- [Contenido de las pesta침as permanece igual] -->
        <!-- Pesta침a de Resumen -->
        <div id="resumen" class="tab-content active">
            <!-- [Contenido igual] -->
        </div>

        <!-- Pesta침a de Mortalidad -->
        <div id="mortalidad" class="tab-content">
            <!-- [Contenido igual] -->
        </div>

        <!-- Pesta침a de Consumo -->
        <div id="consumo" class="tab-content">
            <div class="card">
                <h3>Proyecci칩n de consumo</h3>
                <table id="tabla-consumo">
                    <thead>
                        <tr>
                            <th>Semana</th>
                            <th>Consumo semanal (kg)</th>
                            <th>Total fase (kg)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="fila-semana">
                            <td>Semana 1</td>
                            <td id="semana1">0 kg</td>
                            <td rowspan="3" id="total-inicio">0 kg</td>
                        </tr>
                        <tr class="fila-semana">
                            <td>Semana 2</td>
                            <td id="semana2">0 kg</td>
                        </tr>
                        <tr class="fila-semana">
                            <td>Semana 3</td>
                            <td id="semana3">0 kg</td>
                        </tr>
                        <tr>
                            <td>Semana 4</td>
                            <td id="semana4">0 kg</td>
                            <td rowspan="2" id="total-crecimiento">0 kg</td>
                        </tr>
                        <tr>
                            <td>Semana 5</td>
                            <td id="semana5">0 kg</td>
                        </tr>
                        <tr>
                            <td>Semana 6</td>
                            <td id="semana6">0 kg</td>
                            <td id="total-engorde">0 kg</td>
                        </tr>
                        <tr style="font-weight: bold; background: #f0f7ff;">
                            <td colspan="2">Total 42 d칤as</td>
                            <td id="consumo-total">0 kg</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 1. DATOS INICIALES
        let datos = JSON.parse(localStorage.getItem('pollos')) || {
            pollosIniciales: 0,
            pollosMuertos: 0,
            fechaInicio: null,
            historialMortalidad: []
        };

        // 2. CONSTANTES DE CONSUMO (en gramos por pollo por d칤a)
        const consumoDiario = [20.30, 46.90, 90.00, 142.10, 183.70, 206.60];
        
        // 3. FUNCI칍N PARA ACTUALIZAR PROYECCI칍N DE CONSUMO
        function actualizarProyeccionConsumo() {
            console.log("Actualizando proyecci칩n de consumo...");
            const pollos = datos.pollosIniciales || 0;
            
            // Calcular consumo para cada semana (convertir a kg)
            const semana1 = (pollos * consumoDiario[0] * 7) / 1000;
            const semana2 = (pollos * consumoDiario[1] * 7) / 1000;
            const semana3 = (pollos * consumoDiario[2] * 7) / 1000;
            const semana4 = (pollos * consumoDiario[3] * 7) / 1000;
            const semana5 = (pollos * consumoDiario[4] * 7) / 1000;
            const semana6 = (pollos * consumoDiario[5] * 7) / 1000;
            
            // Actualizar tabla
            document.getElementById('semana1').textContent = semana1.toFixed(2) + ' kg';
            document.getElementById('semana2').textContent = semana2.toFixed(2) + ' kg';
            document.getElementById('semana3').textContent = semana3.toFixed(2) + ' kg';
            document.getElementById('semana4').textContent = semana4.toFixed(2) + ' kg';
            document.getElementById('semana5').textContent = semana5.toFixed(2) + ' kg';
            document.getElementById('semana6').textContent = semana6.toFixed(2) + ' kg';
            
            // Calcular totales por fase
            const totalInicio = semana1 + semana2 + semana3;
            const totalCrecimiento = semana4 + semana5;
            const totalEngorde = semana6;
            const totalGeneral = totalInicio + totalCrecimiento + totalEngorde;
            
            // Actualizar totales
            document.getElementById('total-inicio').textContent = totalInicio.toFixed(2) + ' kg';
            document.getElementById('total-crecimiento').textContent = totalCrecimiento.toFixed(2) + ' kg';
            document.getElementById('total-engorde').textContent = totalEngorde.toFixed(2) + ' kg';
            document.getElementById('consumo-total').textContent = totalGeneral.toFixed(2) + ' kg';
            
            console.log("Proyecci칩n actualizada:", {
                pollosIniciales: pollos,
                semana1: semana1,
                semana2: semana2,
                totalGeneral: totalGeneral
            });
        }

        // 4. FUNCIONES PRINCIPALES
        function mostrarTab(tabId) {
            console.log("Mostrando pesta침a:", tabId);
            // Ocultar todos los contenidos y desactivar todas las pesta침as
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activar la pesta침a seleccionada
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="mostrarTab('${tabId}')"]`).classList.add('active');
            
            // Si es la pesta침a de consumo, actualizar los datos
            if(tabId === 'consumo') {
                console.log("Actualizando pesta침a de consumo...");
                actualizarProyeccionConsumo();
            }
        }

        function actualizar() {
            console.log("Actualizando aplicaci칩n...");
            const tieneCrianza = datos.fechaInicio !== null;
            
            document.getElementById('formulario-inicio').style.display = tieneCrianza ? 'none' : 'block';
            document.getElementById('resumen-crianza').style.display = tieneCrianza ? 'block' : 'none';
            
            if (!tieneCrianza) {
                document.getElementById('fecha-inicio').valueAsDate = new Date();
                actualizarProyeccionConsumo();
                return;
            }
            
            // [Resto de la funci칩n actualizar permanece igual]
        }

        // [Las funciones iniciarCrianza, registrarMuertos, eliminarCrianza permanecen igual]

        // 6. INICIALIZACI칍N
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Documento cargado, inicializando...");
            
            // Establecer fecha actual
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            document.getElementById('fecha-inicio').value = dateStr;
            
            // Mostrar pesta침a de resumen
            mostrarTab('resumen');
            
            // Actualizar toda la aplicaci칩n
            actualizar();
            
            // Forzar actualizaci칩n de consumo al inicio
            actualizarProyeccionConsumo();
            
            console.log("Inicializaci칩n completada");
        });
    </script>
</body>
</html>
